/*! ajaxnoir 2017-04-28 */

function Login(a){var b=$(a);b.submit(function(c){c.preventDefault(),$.ajax({url:"post/login.php",data:b.serialize(),method:"POST",success:function(b){var c=parse_json(b);c.ok?window.location.assign("./"):$(a+" .message").html("<p>"+c.message+"</p>")},error:function(b,c,d){$(a+" .message").html("<p>Error: "+d+"</p>"),console.log(d)}}),console.log("Submitted")})}function MovieInfo(a,b,c){console.log("MovieInfo: "+b+"/"+c);var d=($(a),this);$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"6376507a340c6770c0cf517e8bfed1a8",query:b,year:c},method:"GET",dataType:"text",success:function(b){var c=parse_json(b);0==c.total_results?$(".paper").html("<p>No information available</p>"):(d.successPrint(a,c.results[0]),console.log(c.results[0]))},error:function(a,b,c){$(".paper").html("<p>Unable to connect</p>")}})}function parse_json(a){try{var b=$.parseJSON(a)}catch(b){throw"JSON parse error: "+a}return b}function Stars(a){console.log("Stars constructor"),that=this;for(var b=$(a+" table"),c=b.find("tr"),d=1;d<c.length;d++)for(var e=$(c.get(d)),f=e.find('input[name="id"]').val(),g=e.find("img"),h=0;h<g.length;h++){var i=$(g.get(h));this.installListener(e,i,f,h+1)}}MovieInfo.prototype.successPrint=function(a,b){console.log(b);var c="<ul><li id='info'><a href='#'><img src='images/info.png'></a><div class='show'>";c+="<h1>Title: "+b.title+"</h1>",c+="<p>Release Date: "+b.release_date+"</p>",c+="<p>Vote Average: "+b.vote_average+"</p>",c+="<p>Vote Count: "+b.vote_count+"</p>",c+="</div></li>",c+="<li id='plot'><a href='#'><img src='images/plot.png'></a><div>",c+="<p>"+b.overview+"</p>",c+="</div></li>",c+="<li id='poster'><a href='#'><img src='images/poster.png'></a>",c+="<div><p class='poster'><img id='poster' src=''></p>",c+="</div></li></ul>",$(a).html(c),$("img#poster").attr("src","http://image.tmdb.org/t/p/w500/"+b.poster_path),$(document).ready(function(){$("li#info > a").click(function(){$("ul > li > a > img").css("opacity",.3),$("li#plot > div").fadeOut(1e3),$("li#poster > div").fadeOut(1e3),$("li#info > div").fadeIn(1e3)}),$("li#poster > a").click(function(){$("ul > li > a > img").css("opacity",.3),$("li#info > div").fadeOut(1e3),$("li#plot > div").fadeOut(1e3),$("li#poster > div").fadeIn(1e3)}),$("li#plot > a").click(function(){$("ul > li > a > img").css("opacity",.3),$("li#info > div").fadeOut(1e3),$("li#poster > div").fadeOut(1e3),$("li#plot > div").fadeIn(1e3)})})},Stars.prototype.updateTable=function(a){$("table").html(a)},Stars.prototype.installListener=function(a,b,c,d){var e=this;b.click(function(){console.log("Click on "+c+" rating: "+d),$.ajax({url:"post/stars.php",data:{id:c,rating:d},method:"POST",success:function(b){var c=parse_json(b);c.ok?(e.update(a,d),e.updateTable(c.table),e.message("<p>Successfully updated</p>")):e.message("<p>Update failed</p>")},error:function(a,b,c){e.message("<p>Error: "+c+"</p>")}})})},Stars.prototype.update=function(a,b){for(var c=a.find("img"),d=0;d<c.length;d++){var e=$(c.get(d));d<b?e.attr("src","images/star-green.png"):e.attr("src","images/star-gray.png")}a.find("span.num").text(b+"/10")},Stars.prototype.message=function(a){$(".message").html(a).show().delay(2e3).fadeIn(1e3).fadeOut(1e3)};